<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset = "UTF-8">
	<meta name = "viewport" content = "width=device-width, initial-scale = 1.0">
	<title>ÊäïÁ®øË©≥Á¥∞- FoodBoard</title>
	
	<!--Bootstrap CSS-->
	<link href = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
	<link rel="stylesheet" th:href="@{/css/bottom-nav.css}">
	
	<style> 
	.mobile-container{
		    max-width: 430px;
		    margin: 0 auto;
		    min-height: 100vh;  /* ‚úÖ height ‚Üí min-height Î≥ÄÍ≤Ω */
		    background-color: #ffffff;
		    border-left: 1px solid #f0f0f0;
		    border-right: 1px solid #f0f0f0;
		    display: flex;
		    flex-direction: column;
		    padding: 0;
		    padding-bottom: 70px;
		    overflow-y: auto;  /* ‚úÖ Ï∂îÍ∞Ä */
		}
	header 	{
		    position: sticky; 
		    top: 0;
		    z-index: 1020; 
		    width: 100%; 
		    background-color: #ffecd9;
		    flex-shrink: 0;  /* ‚úÖ Ï∂îÍ∞Ä */
		}

		/* ‚úÖ Í≤åÏãúÍ∏Ä ÏòÅÏó≠ */
		main {
		    flex-shrink: 0;
		}

		/* ‚úÖ ÎåìÍ∏Ä ÏûÖÎ†•Ï∞Ω ÏòÅÏó≠ */
		.comment-input-area {
		    flex-shrink: 0;
		    border-top: 1px solid #dee2e6;
		}

		.comment-section {
		    flex-shrink: 0;
		    display: flex;
		    flex-direction: column;
		    /* max-heightÏôÄ overflow-y Ï†úÍ±∞ */
		}

		.comment-list {
		    flex: 1;
		    max-height: calc(100vh - 500px);  /* Ïó¨Í∏∞Î°ú Ïù¥Îèô */
		    overflow-y: auto;
		}

		/* ‚úÖ ÎåìÍ∏Ä Í¥ÄÎ†® Ïä§ÌÉÄÏùº */
		.edit-form {
		    display: none;
		}

		.reply-form {
		    display: none;
		}

		.comment-actions {
		    font-size: 0.85rem;
		}

		.comment-actions span,
		.comment-actions button {
		    cursor: pointer;
		}

		.comment-actions span:hover,
		.comment-actions button:hover {
		    opacity: 0.7;
		}
		
		/* ‚úÖ textarea ÎÜíÏù¥ Í≥†Ï†ï */
		#commentInput {
		    resize: none !important;
		    overflow-y: auto;
		}
		/* ‚úÖ Ï†ïÎ†¨ Î≤ÑÌäº ÌôúÏÑ±Ìôî Ïä§ÌÉÄÏùº */
		.btn-sort-active {
		    background-color: #6c757d !important;
		    color: white !important;
		    border-color: #6c757d !important;
		}
		</style>
</head>

<body>
	<div class = "container-fluid px-0">
		<div class = "mobile-container">
			<header class = "d-flex justify-content-between align-items-center py-3 px-3"
					style = "background-color: #ffecd9; min-height: 85px;">
					
					<a th:href = "@{/board}"
					   class = "d-inline-flex align-items-center justify-content-center"
					   style = "cursor: pointer; font-size: 24px; line-height: 1; width: 24px; height: 24px; text-decoration: none; color: black;">„Äà</a>
						
					<h5 class = "mb-0 fw-bold">„Ç∞„É´„É°Êé≤Á§∫Êùø</h5>
					
				<div class = "dropdown">
					<span style = "cursor: pointer; font-size: 24px;" 
						   data-bs-toggle = "dropdown">‚ãÆ</span>
					<ul class = "dropdown-menu dropdown-menu-end">
						<li>
							<a class="dropdown-item" th:href="@{/board/edit/{id}(id=${board.id})}">
								‚úèÔ∏è ‰øÆÊ≠£„Åô„Çã
							</a>
						</li>
						<li><hr class ="dropdown-divider"></li>
						<li>
							<a class = "dropdown-item text-danger" href = "#" onclick= "deletePost()">
								üóëÔ∏è ÂâäÈô§„Åô„Çã
							</a>
						</li>
					</ul>
				</div>
				
		
			</header>
			<!--Í≤åÏãúÍ∏Ä ÎÇ¥Ïö©-->
			<main class="flex-grow-1">
			    
				<!-- 1. ÏßÄÏó≠Î™Ö + Î≥ÑÏ†ê + ÏûëÏÑ±Ïûê + ÎÇ†Ïßú (Ìïú Ï§Ñ) -->
				<div class="px-3 pt-3 d-flex justify-content-between align-items-center">
				    <div class="d-flex align-items-center gap-2">
				        <span class="badge bg-warning text-dark" th:text="${board.prefecture}"></span>
						<span class="text-warning fw-bold d-flex align-items-center gap-1">
							<img src="https://img.icons8.com/ios-filled/20/ffc107/star.png" alt="Î≥ÑÏ†ê" style="width:18px; height:18px;">
							<span th:text="${board.rating}"></span>
				    	</span>
						</div>
				    <div class="small text-muted">
				        <span th:text="${#temporals.format(board.createdAt, 'MM/dd HH:mm')}"></span>
				        <span>|</span>
				        <span th:text="${board.user != null ? board.user.username : 'ÂåøÂêç'}"></span>
				    </div>
				</div>
			    
			    <!-- 2. Ï†úÎ™© -->
			    <div class="px-3 pt-2">
			        <h5 class="fw-bold mb-0" th:text="${board.title}"></h5>
			    </div>
			    
			    <!-- 3. Ïù¥ÎØ∏ÏßÄ (Ïó¨Îü¨ Ïû•, ÏòÜÏúºÎ°ú Ïä§ÌÅ¨Î°§) -->
				<div class="px-3 py-3" th:if="${board.imageUrls != null and !board.imageUrls.isEmpty()}">
				    <div class="d-flex gap-2"
				         style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
				        <img th:each="url : ${board.imageUrls.split(',')}"
				             th:src="${url}" 
				             alt="ÊäïÁ®ø„Ç§„É°„Éº„Ç∏"
				             class="rounded flex-shrink-0"
				             style="width: 100%; max-width: 350px; height: 250px; object-fit: cover;">
				    </div>
			    
			        <!-- Ïù¥ÎØ∏ÏßÄ ÏóÜÏùÑ Îïå -->
			        <div th:if="${board.imageUrls == null or board.imageUrls.isEmpty()}"
			             class="bg-light rounded d-flex align-items-center justify-content-center"
			             style="height: 200px;">
			            <span class="text-muted">No Image</span>
			        </div>
			    </div>
			    
			    <!-- 4. Í∏Ä ÎÇ¥Ïö© -->
			    <div class="px-3 py-2">
			        <p class="mb-0" style="line-height: 1.6;" th:text="${board.content}"></p>
			    </div>
				
			</main>
			
			<!-- ‚úÖ Í≤åÏãúÍ∏Ä Ï¢ãÏïÑÏöî/ÎåìÍ∏Ä Î≤ÑÌäº Ï∂îÍ∞Ä -->
			<div class="px-3 py-3 border-top">
			    <div class="d-flex align-items-center gap-3">
			        <!-- Ï¢ãÏïÑÏöî -->
			        <form th:action="@{/board/like}" method="post" class="d-inline" onsubmit="return checkLoginForAction(event)">
			            <input type="hidden" name="boardId" th:value="${board.id}">
			            <button type="submit" class="btn btn-link btn-sm p-0 text-decoration-none text-muted">
			                <img th:src="${board.likedByMe ? 'https://img.icons8.com/ios-filled/22/ff6b6b/like.png' : 'https://img.icons8.com/ios/22/888888/like.png'}" 
			                     alt="like" style="vertical-align: middle;">
								 <span>„ÅÑ„ÅÑ„Å≠ÔºÅ</span>
			                <span th:text="${board.likeCount}">0</span>
			            </button>
			        </form>
			        
					<!-- ÎåìÍ∏Ä Í∞úÏàò (ÌÅ¥Î¶≠Ïãú ÎåìÍ∏Ä ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô) -->
					<span th:href="@{/post/{id}(id=${board.id})}" class="text-decoration-none text-muted">
					    <img src="https://img.icons8.com/ios/22/888888/comments.png" alt="comments" style="vertical-align: middle;">
					    <span>„Ç≥„É°„É≥„Éà</span>
					    <span th:text="${comments != null ? comments.size() : 0}">0</span>
					</span>
					
					<!--Ï°∞ÌöåÏàò Ï∂îÍ∞Ä-->
					<span class="text-muted ms-auto">
						<img src="https://img.icons8.com/ios/22/888888/eye.png" alt="Ï°∞ÌöåÏàò" style="vertical-align: middle;">
						<span th:text="${board.viewCount}">0</span>
					</span>
						
			    </div>
			</div>

			<!--ÎåìÍ∏Ä ÏÑπÏÖò Ï∂îÍ∞Ä -->
			<div id="commentSection" class="comment-section">
				<!-- ÎåìÍ∏Ä ÏûÖÎ†• -->
			    <div class="bg-white px-3 py-3" style="position: sticky; bottom: 0; z-index: 100; border-top: 1px solid #dee2e6;">
				    <form th:action="@{/board/comment/add}" method="post" onsubmit="return checkLoginForAction(event)">
				        <input type="hidden" name="boardId" th:value="${board.id}">
				        <textarea id="commentInput" 
				                  name="content" 
				                  class="form-control mb-2" 
				                  placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"
				                  onclick="checkLoginForClick(event)" 
				                  rows="2"
				                  required></textarea>
				        <button type="submit"
				                class="btn btn-primary w-100 fw-bold rounded-pill py-2">
				          ÁôªÈå≤
				        </button>
				    </form>
				</div>

			    <!-- Ï†ïÎ†¨ Î≤ÑÌäº -->
			    <div class="comment-section" th:if="${comments != null && !comments.isEmpty()}">
				    <!-- Ï†ïÎ†¨ Î≤ÑÌäº -->
				    <div class="px-3 py-3 bg-white border-bottom sticky-top" style="top: 0;">
				        <div class="d-flex justify-content-end gap-2">
							<button type="button" 
							        class="btn btn-sm btn-outline-secondary rounded-pill px-3" 
							        id="sort-newest" 
							        th:classappend="${sortOrder == 'newest' ? 'btn-sort-active' : ''}"
							        onclick="sortComments('newest')">
							    Êñ∞ÁùÄÈ†Ü
							</button>
							<button type="button" 
							        class="btn btn-sm btn-outline-secondary rounded-pill px-3" 
							        id="sort-oldest" 
							        th:classappend="${sortOrder == null or sortOrder == 'oldest' ? 'btn-sort-active' : ''}"
							        onclick="sortComments('oldest')">
							    ÊäïÁ®øÈ†Ü
							</button>
				        </div>
				    </div>
			    </div>
			    <!-- ÎåìÍ∏Ä Î¶¨Ïä§Ìä∏ -->
			    <div class="comment-list">
					<div class="comment px-3 py-3 border-bottom"
					     th:each="comment : ${comments}"
					     th:id="'comment-' + ${comment.id}">
			            <div class="d-flex align-items-center gap-2 mb-2">
			                <!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ -->
			                <div th:if="${comment.user != null && comment.user.profileImageUrl != null}"
			                     class="rounded-circle"
			                     th:style="'background-image: url(' + ${comment.user.profileImageUrl} + '); background-size: cover; background-position: center; width: 32px; height: 32px;'">
			                </div>
			                <div th:unless="${comment.user != null && comment.user.profileImageUrl != null}"
			                     class="rounded-circle bg-secondary"
			                     style="width: 32px; height: 32px;">
			                </div>
			                
			                <!-- ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ -->
			                <span class="fw-semibold" 
			                      th:text="${comment.user != null ? comment.user.name : comment.author}">
			                    „É¶„Éº„Ç∂„Éº
			                </span>
			                
			                <span class="text-muted small" 
			                      th:text="${comment.createdAt != null ? #temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm') : '2026-01-19 14:30'}">
			                    2026-01-19 14:30
			                </span>
			            </div>
			            
			            <!-- ÎåìÍ∏Ä ÎÇ¥Ïö© -->
			            <div class="mb-2" th:text="${comment.content}" 
			                 th:id="'comment-content-' + ${comment.id}">
			                „Ç≥„É°„É≥„ÉàÂÜÖÂÆπ
			            </div>
			            
			            <!-- ÎåìÍ∏Ä ÏàòÏ†ï Ìèº -->
			            <div class="edit-form" th:id="'edit-form-' + ${comment.id}" style="display: none;">
			                <form th:action="@{/board/comment/edit}" method="post" onsubmit="return checkLoginForAction(event)">
			                    <input type="hidden" name="commentId" th:value="${comment.id}">
			                    <textarea name="content" class="form-control mb-2" th:text="${comment.content}" required></textarea>
			                    <div class="d-flex gap-2">
			                        <button type="submit" class="btn btn-sm btn-primary">‰øùÂ≠ò</button>
			                        <button type="button" class="btn btn-sm btn-secondary"
			                                th:onclick="'toggleEdit(' + ${comment.id} + ')'">„Ç≠„É£„É≥„Çª„É´</button>
			                    </div>
			                </form>
			            </div>
			            
			            <!-- ÎåìÍ∏Ä Ïï°ÏÖò -->
			            <div class="comment-actions d-flex align-items-center gap-2 small text-muted">
			                <!-- Ï¢ãÏïÑÏöî -->
			                <form th:action="@{/board/comment/like}" method="post" class="d-inline" onsubmit="return checkLoginForAction(event)">
			                    <input type="hidden" name="commentId" th:value="${comment.id}">
			                    <button type="submit" class="btn btn-link btn-sm p-0 text-decoration-none text-muted">
									<img th:src="${comment.likedByMe ? 'https://img.icons8.com/ios-filled/20/ff6b6b/like.png' : 'https://img.icons8.com/ios/20/888888/like.png'}" 
									     alt="like" style="vertical-align: middle;">
			                        <span th:text="${comment.likeCount}">0</span>
			                    </button>
			                </form>
			                
			                <!-- ÎåÄÎåìÍ∏Ä Ïàò ÌëúÏãú -->
							<span th:onclick="'toggleReply(' + ${comment.id} + ')'"
							      class="d-flex align-items-center gap-1"
							      style="cursor:pointer;">
							    <img src="https://img.icons8.com/ios/20/888888/comments.png">
							    <span th:text="${comment.replies.size()}">0</span>
							</span>
			                
							<!-- ÏàòÏ†ï -->
						  <span th:if="${session.loginUser != null && comment.user != null && session.loginUser.userId == comment.user.userId}"
						  th:onclick="'event.stopPropagation(); checkLoginAndToggleEdit(event,' + ${comment.id} + ')'"
						        style="cursor:pointer;">
								<img src="https://img.icons8.com/ios/20/888888/edit.png"
							         alt="edit"
							         style="vertical-align: middle;">
							    <span>Á∑®ÈõÜ</span>
						  </span>
			                
			                <!-- ÏÇ≠Ï†ú -->
							<form th:if="${session.loginUser != null && comment.user != null && session.loginUser.userId == comment.user.userId}"
							      th:action="@{/board/comment/delete}" method="post" 
							      class="d-inline"
							      onsubmit="event.stopPropagation(); return checkLoginForAction(event) && confirm('Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„Åã?');">
			                    <input type="hidden" name="commentId" th:value="${comment.id}">
								<button type="submit" class="btn btn-link btn-sm p-0 text-decoration-none text-muted">
								    <img src="https://img.icons8.com/ios/20/888888/delete.png" alt="delete" style="vertical-align: middle;"> ÂâäÈô§
								</button>
			                </form>
			            </div>
			            
			            <!-- ÎåÄÎåìÍ∏Ä ÏûÖÎ†• Ìèº -->
			            <div class="reply-form mt-2" th:id="'reply-form-' + ${comment.id}" style="display: none;">
			                <form th:action="@{/board/comment/reply}" method="post" onsubmit="return checkLoginForAction(event)">
			                    <input type="hidden" name="parentId" th:value="${comment.id}">
			                    <textarea name="content" 
			                              class="form-control mb-2" 
			                              placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"
			                              onclick="checkLoginForClick(event)" 
			                              required></textarea>
			                    <div class="d-flex gap-2">
			                        <button type="submit" class="btn btn-sm btn-danger">ÁôªÈå≤</button>
			                        <button type="button" class="btn btn-sm btn-secondary"
			                                th:onclick="'toggleReply(' + ${comment.id} + ')'">„Ç≠„É£„É≥„Çª„É´</button>
			                    </div>
			                </form>
			            </div>
			            
			            <!-- ÎåÄÎåìÍ∏Ä Î™©Î°ù -->
			            <div th:if="${comment.replies != null && !comment.replies.isEmpty()}">
			                <div class="reply bg-light rounded px-2 py-2 ms-4 mt-2" th:each="reply : ${comment.replies}">
			                    <div class="d-flex align-items-center gap-2 mb-2">
			                        <!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ -->
			                        <div th:if="${reply.user != null && reply.user.profileImageUrl != null}"
			                             class="rounded-circle"
			                             th:style="'background-image: url(' + ${reply.user.profileImageUrl} + '); background-size: cover; background-position: center; width: 24px; height: 24px;'">
			                        </div>
			                        <div th:unless="${reply.user != null && reply.user.profileImageUrl != null}"
			                             class="rounded-circle bg-secondary"
			                             style="width: 24px; height: 24px;">
			                        </div>
			                        
			                        <!-- ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ -->
			                        <span class="fw-semibold small" 
			                              th:text="${reply.user != null ? reply.user.name : reply.author}">
			                            „É¶„Éº„Ç∂„Éº
			                        </span>
			                        
			                        <span class="text-muted small" 
			                              th:text="${reply.createdAt != null ? #temporals.format(reply.createdAt, 'yyyy-MM-dd HH:mm') : '2026-01-19 14:35'}">
			                            2026-01-19 14:35
			                        </span>
			                    </div>
			                    
			                    <!-- ÎåÄÎåìÍ∏Ä ÎÇ¥Ïö© -->
			                    <div class="mb-2 small" th:text="${reply.content}" 
			                         th:id="'reply-content-' + ${comment.id} + '-' + ${reply.id}">
			                        „Ç≥„É°„É≥„ÉàÂÜÖÂÆπ
			                    </div>
								
								<!-- ‚úÖ ÎåÄÎåìÍ∏Ä ÏàòÏ†ï Ìèº Ï∂îÍ∞Ä -->
								        <div class="edit-form" th:id="'reply-edit-form-' + ${comment.id} + '-' + ${reply.id}" style="display: none;">
								            <form th:action="@{/board/comment/reply/edit}" method="post" onsubmit="return checkLoginForAction(event)">
								                <input type="hidden" name="parentId" th:value="${comment.id}">
								                <input type="hidden" name="replyId" th:value="${reply.id}">
								                <textarea name="content" class="form-control mb-2" th:text="${reply.content}" required></textarea>
								                <div class="d-flex gap-2">
								                    <button type="submit" class="btn btn-sm btn-primary">‰øùÂ≠ò</button>
								                    <button type="button" class="btn btn-sm btn-secondary"
								                            th:onclick="'toggleReplyEdit(' + ${comment.id} + ',' + ${reply.id} + ')'">„Ç≠„É£„É≥„Çª„É´</button>
								                </div>
								            </form>
								        </div>
			                    
			                    <!-- ÎåÄÎåìÍ∏Ä Ïï°ÏÖò -->
			                    <div class="comment-actions small text-muted d-flex gap-2">
			                        <!-- ÎåÄÎåìÍ∏Ä Ï¢ãÏïÑÏöî -->
			                        <form th:action="@{/board/comment/reply/like}" method="post" class="d-inline" onsubmit="return checkLoginForAction(event)">
			                            <input type="hidden" name="parentId" th:value="${comment.id}">
			                            <input type="hidden" name="replyId" th:value="${reply.id}">
			                            <button type="submit" class="btn btn-link btn-sm p-0 text-decoration-none text-muted">
											<img th:src="${reply.likedByMe ? 'https://img.icons8.com/ios-filled/20/ff6b6b/like.png' : 'https://img.icons8.com/ios/20/888888/like.png'}" 
											     alt="like" style="vertical-align: middle;">
			                                <span th:text="${reply.likeCount}">0</span>
			                            </button>
			                        </form>
			                        
			                        <span th:if="${session.loginUser != null && reply.user != null && session.loginUser.userId == reply.user.userId}"
									      th:onclick="'checkLoginAndToggleReplyEdit(event,' + ${comment.id} + ',' + ${reply.id} + ')'" 
									      style="cursor:pointer;">
										  <img src="https://img.icons8.com/ios/20/888888/edit.png"
										       alt="edit"
										       style="vertical-align: middle;">
										  <span>Á∑®ÈõÜ</span>
									</span>
			                        
			                        <!-- ÎåÄÎåìÍ∏Ä ÏÇ≠Ï†ú -->
			                        <form th:if="${session.loginUser != null && reply.user != null && session.loginUser.userId == reply.user.userId}"
									      th:action="@{/board/comment/reply/delete}" method="post" 
									      class="d-inline"
									      onsubmit="event.stopPropagation(); return checkLoginForAction(event) && confirm('Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„Åã?');"
			                            <input type="hidden" name="parentId" th:value="${comment.id}">
			                            <input type="hidden" name="replyId" th:value="${reply.id}">
			                            <button type="submit" class="btn btn-link btn-sm p-0 text-decoration-none text-muted">
											<img src="https://img.icons8.com/ios/20/888888/delete.png" alt="delete" style="vertical-align: middle;"> ÂâäÈô§
			                            </button>
			                        </form>
			                    </div>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
			
			<!-- Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Ïä§ÌÅ¨Î¶ΩÌä∏ -->
			<script th:inline="javascript">
				/*<![CDATA[*/
				const isLoggedIn = /*[[${isLoggedIn}]]*/ false;
				/*]]>*/
						
				// ==== Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨ Ìï®Ïàò ====
				function checkLoginForAction(event) {
				        if (!isLoggedIn) {
				            event.preventDefault();
				            if (confirm('„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ„É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å´ÁßªÂãï„Åó„Åæ„Åô„ÅãÔºü')) {
				                location.href = '/login?returnUrl=' + encodeURIComponent(location.pathname);
				            }
				            return false;
				        }
				        return true;
				    }
			    
				function checkLoginForClick(event) {
				        if (!isLoggedIn) {
				            event.preventDefault();
				            if (confirm('„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ„É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å´ÁßªÂãï„Åó„Åæ„Åô„ÅãÔºü')) {
				                location.href = '/login?returnUrl=' + encodeURIComponent(location.pathname);
				            }
				        }
				    }
						  
				// ==== ÎåìÍ∏Ä ÏàòÏ†ï Ìï®Ïàò ====  
				function toggleEdit(commentId) {
				    const content = document.getElementById('comment-content-' + commentId);
				    const form = document.getElementById('edit-form-' + commentId);
				    const replyForm = document.getElementById('reply-form-' + commentId);
				    
					// ‚úÖ ÎåÄÎåìÍ∏Ä ÏûÖÎ†•Ï∞Ω Í∞ïÏ†ú Îã´Í∏∞
					    if (replyForm) {
					        replyForm.style.display = 'none';
					    }

					    if (form.style.display === 'none' || form.style.display === '') {
					        content.style.display = 'none';
					        form.style.display = 'block';
					    } else {
					        content.style.display = 'block';
					        form.style.display = 'none';
					    }
					}
						    
				function checkLoginAndToggleEdit(event, commentId) {
					event.stopPropagation(); // ‚úÖ Ï∂îÍ∞Ä
					
			        if (!isLoggedIn) {
			            event.preventDefault();
			            if (confirm('„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ„É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å´ÁßªÂãï„Åó„Åæ„Åô„ÅãÔºü')) {
			                location.href = '/login?returnUrl=' + encodeURIComponent(location.pathname);
			            }
			        } else {
			            toggleEdit(commentId);
			        }
			    }
						
				// ==== ÎåÄÎåìÍ∏Ä ÏûÖÎ†• Ìï®Ïàò ====    
				function toggleReply(commentId) {
				        const form = document.getElementById('reply-form-' + commentId);
				        if (form.style.display === 'none' || form.style.display === '') {
				            form.style.display = 'block';
				        } else {
				            form.style.display = 'none';
				        }
				    }
					
				// ==== ÎåÄÎåìÍ∏Ä ÏàòÏ†ï Ìï®Ïàò ====	    
				function toggleReplyEdit(commentId, replyId) {
				        const content = document.getElementById('reply-content-' + commentId + '-' + replyId);
				        const form = document.getElementById('reply-edit-form-' + commentId + '-' + replyId);
				        
				        if (form && content) {
				            if (form.style.display === 'none' || form.style.display === '') {
				                content.style.display = 'none';
				                form.style.display = 'block';
				            } else {
				                content.style.display = 'block';
				                form.style.display = 'none';
				            }
				        }
				    }
				
				function checkLoginAndToggleReplyEdit(event, commentId, replyId) {
				        if (!isLoggedIn) {
				            event.preventDefault();
				            if (confirm('„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ„É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏„Å´ÁßªÂãï„Åó„Åæ„Åô„ÅãÔºü')) {
				                location.href = '/login?returnUrl=' + encodeURIComponent(location.pathname);
				            }
				        } else {
				            toggleReplyEdit(commentId, replyId);
				        }
				    }
					
				// ==== Ï†ïÎ†¨ Ìï®Ïàò ====
			    function sortComments(order) {
			        location.href = location.pathname + '?sort=' + order;
			    }
						
				// ==== Í≤åÏãúÍ∏Ä ÏÇ≠Ï†ú Ìï®Ïàò ====
				function deletePost(){
					if(confirm('Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')){
						const form = document.createElement('form');
						form.method = 'POST';
						form.action = '/board/delete/[[${board.id}]]';
						document.body.appendChild(form);
						form.submit();
					}
				}
				
				// ========== ÎπÑÎèôÍ∏∞ Ï≤òÎ¶¨ ==========

				// ÌéòÏù¥ÏßÄ Î°úÎìú ÌõÑ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
				document.addEventListener('DOMContentLoaded', function() {
				    
				    // 1. Í≤åÏãúÍ∏Ä Ï¢ãÏïÑÏöî
				    const boardLikeForm = document.querySelector('form[action*="/board/like"]');
				    if (boardLikeForm) {
				        boardLikeForm.addEventListener('submit', function(e) {
				            e.preventDefault();
				            
				            if (!checkLoginForAction(e)) return;
				            
				            const formData = new FormData(this);
				            const boardId = formData.get('boardId');
				            const likeBtn = this.querySelector('button');
				            const likeImg = likeBtn.querySelector('img');
				            const likeCount = likeBtn.querySelector('span:last-child');
				            
				            fetch('/api/board/like', {
				                method: 'POST',
				                body: formData
				            })
				            .then(response => response.json())
				            .then(data => {
				                if (data.success) {
				                    if (data.liked) {
				                        likeImg.src = 'https://img.icons8.com/ios-filled/22/ff6b6b/like.png';
				                    } else {
				                        likeImg.src = 'https://img.icons8.com/ios/22/888888/like.png';
				                    }
				                    likeCount.textContent = data.likeCount;
				                }
				            });
				        });
				    }
				    
				    // 2. ÎåìÍ∏Ä Ï∂îÍ∞Ä
				    const commentAddForm = document.querySelector('form[action*="/board/comment/add"]');
				    if (commentAddForm) {
				        commentAddForm.addEventListener('submit', function(e) {
				            e.preventDefault();
				            
				            if (!checkLoginForAction(e)) return;
				            
				            const formData = new FormData(this);
				            const textarea = this.querySelector('textarea');
				            
				            fetch('/api/board/comment/add', {
				                method: 'POST',
				                body: formData
				            })
				            .then(response => response.json())
				            .then(data => {
				                if (data.success) {
				                    // ÎåìÍ∏Ä Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
				                    location.reload();
				                } else {
				                    alert(data.message);
				                }
				            });
				        });
				    }
				    
				    // 3. ÎåìÍ∏Ä Ï¢ãÏïÑÏöî
				    document.querySelectorAll('form[action*="/board/comment/like"]:not([action*="reply"])').forEach(form => {
				        form.addEventListener('submit', function(e) {
				            e.preventDefault();
				            
				            if (!checkLoginForAction(e)) return;
				            
				            const formData = new FormData(this);
				            const likeBtn = this.querySelector('button');
				            const likeImg = likeBtn.querySelector('img');
				            const likeCount = likeBtn.querySelector('span:last-child');
				            
				            fetch('/api/board/comment/like', {
				                method: 'POST',
				                body: formData
				            })
				            .then(response => response.json())
				            .then(data => {
				                if (data.success) {
				                    if (data.liked) {
				                        likeImg.src = 'https://img.icons8.com/ios-filled/20/ff6b6b/like.png';
				                    } else {
				                        likeImg.src = 'https://img.icons8.com/ios/20/888888/like.png';
				                    }
				                    likeCount.textContent = data.likeCount;
				                }
				            });
				        });
				    });
				    
				    // 4. ÎåìÍ∏Ä ÏàòÏ†ï
				    document.querySelectorAll('form[action*="/board/comment/edit"]:not([action*="reply"])').forEach(form => {
				        form.addEventListener('submit', function(e) {
				            e.preventDefault();
				            
				            if (!checkLoginForAction(e)) return;
				            
				            const formData = new FormData(this);
				            const commentId = formData.get('commentId');
				            const newContent = formData.get('content');
				            
				            fetch('/api/board/comment/edit', {
				                method: 'POST',
				                body: formData
				            })
				            .then(response => response.json())
				            .then(data => {
				                if (data.success) {
				                    const contentDiv = document.getElementById('comment-content-' + commentId);
				                    contentDiv.textContent = data.content;
				                    toggleEdit(commentId);
				                }
				            });
				        });
				    });
				    
				    // 5. ÎåìÍ∏Ä ÏÇ≠Ï†ú
				    document.querySelectorAll('form[action*="/board/comment/delete"]:not([action*="reply"])').forEach(form => {
				        form.addEventListener('submit', function(e) {
				            e.preventDefault();
				            
				            if (!checkLoginForAction(e)) return;
				            if (!confirm('Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„Åã?')) return;
				            
				            const formData = new FormData(this);
				            const commentId = formData.get('commentId');
				            
				            fetch('/api/board/comment/delete', {
				                method: 'POST',
				                body: formData
				            })
				            .then(response => response.json())
				            .then(data => {
				                if (data.success) {
				                    const commentDiv = document.getElementById('comment-' + commentId);
				                    commentDiv.remove();
				                }
				            });
				        });
				    });
				    
				    // 6. ÎåÄÎåìÍ∏Ä Ï∂îÍ∞Ä
				    document.querySelectorAll('form[action*="/board/comment/reply"]:not([action*="edit"]):not([action*="delete"]):not([action*="like"])').forEach(form => {
				        form.addEventListener('submit', function(e) {
				            e.preventDefault();
				            
				            if (!checkLoginForAction(e)) return;
				            
				            const formData = new FormData(this);
				            
				            fetch('/api/board/comment/reply', {
				                method: 'POST',
				                body: formData
				            })
				            .then(response => response.json())
				            .then(data => {
				                if (data.success) {
				                    location.reload();
				                }
				            });
				        });
				    });
				    
				    // 7. ÎåÄÎåìÍ∏Ä ÏàòÏ†ï
				    document.querySelectorAll('form[action*="/board/comment/reply/edit"]').forEach(form => {
				        form.addEventListener('submit', function(e) {
				            e.preventDefault();
				            
				            if (!checkLoginForAction(e)) return;
				            
				            const formData = new FormData(this);
				            const parentId = formData.get('parentId');
				            const replyId = formData.get('replyId');
				            
				            fetch('/api/board/comment/reply/edit', {
				                method: 'POST',
				                body: formData
				            })
				            .then(response => response.json())
				            .then(data => {
				                if (data.success) {
				                    const contentDiv = document.getElementById('reply-content-' + parentId + '-' + replyId);
				                    contentDiv.textContent = data.content;
				                    toggleReplyEdit(parentId, replyId);
				                }
				            });
				        });
				    });
				    
				    // 8. ÎåÄÎåìÍ∏Ä ÏÇ≠Ï†ú
				    document.querySelectorAll('form[action*="/board/comment/reply/delete"]').forEach(form => {
				        form.addEventListener('submit', function(e) {
				            e.preventDefault();
				            
				            if (!checkLoginForAction(e)) return;
				            if (!confirm('Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„Åã?')) return;
				            
				            const formData = new FormData(this);
				            
				            fetch('/api/board/comment/reply/delete', {
				                method: 'POST',
				                body: formData
				            })
				            .then(response => response.json())
				            .then(data => {
				                if (data.success) {
				                    location.reload();
				                }
				            });
				        });
				    });
				    
				    // 9. ÎåÄÎåìÍ∏Ä Ï¢ãÏïÑÏöî
				    document.querySelectorAll('form[action*="/board/comment/reply/like"]').forEach(form => {
				        form.addEventListener('submit', function(e) {
				            e.preventDefault();
				            
				            if (!checkLoginForAction(e)) return;
				            
				            const formData = new FormData(this);
				            const likeBtn = this.querySelector('button');
				            const likeImg = likeBtn.querySelector('img');
				            const likeCount = likeBtn.querySelector('span:last-child');
				            
				            fetch('/api/board/comment/reply/like', {
				                method: 'POST',
				                body: formData
				            })
				            .then(response => response.json())
				            .then(data => {
				                if (data.success) {
				                    if (data.liked) {
				                        likeImg.src = 'https://img.icons8.com/ios-filled/20/ff6b6b/like.png';
				                    } else {
				                        likeImg.src = 'https://img.icons8.com/ios/20/888888/like.png';
				                    }
				                    likeCount.textContent = data.likeCount;
				                }
				            });
				        });
				    });
				});
				
			</script>

			<!-- Bootstrap JS -->
			<script src = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

			<!-- Bottom Navigation Bar -->
			<div th:replace="~{fragments/bottom-nav :: bottomNav}"></div>

		</body>
</html>

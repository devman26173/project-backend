<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Post</title>
    <link rel="stylesheet" th:href="@{/css/post.css}">
    <style>
        .edit-form {
            display: none;
            margin-top: 8px;
        }
        .edit-form.active {
            display: block;
        }
        .reply-form {
            display: none;
            margin-top: 8px;
            margin-left: 24px;
        }
        .reply-form.active {
            display: block;
        }
        .comment-actions span {
            cursor: pointer;
            margin-right: 12px;
        }
        .comment-actions span:hover {
            opacity: 0.7;
        }
    </style>
</head>
<body>
<div class="page">
    <!-- ê²Œì‹œê¸€ ì¹´ë“œ -->
    <div class="post-card">
        <div class="post-header">
            <div class="profile"></div>
            <div class="author">1234</div>
        </div>
        <div class="post-content" th:text="${post.content}">
            ê²Œì‹œê¸€ ë‚´ìš©ì…ë‹ˆë‹¤
        </div>
        <div class="post-actions">
            <!-- â¤ï¸ ì¢‹ì•„ìš” ë²„íŠ¼ -->
            <form th:action="@{/post/like}" method="post" style="display:inline;">
                <button type="submit" style="background:none; border:none; cursor:pointer;">
                    <span th:text="${post.likedByMe ? 'â¤ï¸ ì¢‹ì•„ìš”' : 'ğŸ¤ ì¢‹ì•„ìš”'}">ğŸ¤ ì¢‹ì•„ìš”</span>
                    <span th:text="${post.likeCount}">0</span>
                </button>
            </form>
            <!-- ğŸ’¬ ëŒ“ê¸€ ë²„íŠ¼ (í´ë¦­ ê°€ëŠ¥í•˜ê²Œ) -->
            <span onclick="toggleCommentSection()" style="cursor:pointer;">
                ğŸ’¬ ëŒ“ê¸€ <span th:text="${commentCount}">0</span>
            </span>
        </div>
    </div>
	<!-- ëŒ“ê¸€ ì„¹ì…˜ ì „ì²´ë¥¼ divë¡œ ê°ì‹¸ê³  ìˆ¨ê¹€ ì²˜ë¦¬ -->
	<div id="comment-section" style="display:hidden;">
	    <!-- ëŒ“ê¸€ ì…ë ¥ -->
	    <div class="comment-form">
	        <form th:action="@{/post/comment/add}" method="post">
	            <textarea name="content" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
	            <button type="submit">ë“±ë¡</button>
	        </form>
	    </div>

	    <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
	    <div class="comment-list">
	        <div class="comment" th:each="comment : ${post.comments}">
	            <div class="comment-header">
	                <div class="profile small"></div>
	                <span class="author" th:text="${comment.author}">ìœ ì €</span>
	                <span class="time">ë°©ê¸ˆ</span>
	            </div>
            
            <!-- ëŒ“ê¸€ ë‚´ìš© -->
            <div class="comment-content" th:text="${comment.content}" 
                 th:id="'comment-content-' + ${comment.id}">
                ëŒ“ê¸€ ë‚´ìš©
            </div>
            
            <!-- ëŒ“ê¸€ ìˆ˜ì • í¼ (ìˆ¨ê¹€) -->
            <div class="edit-form" th:id="'edit-form-' + ${comment.id}">
                <form th:action="@{/post/comment/edit}" method="post">
                    <input type="hidden" name="commentId" th:value="${comment.id}">
                    <textarea name="content" th:text="${comment.content}" required></textarea>
                    <button type="submit">ì €ì¥</button>
                    <button type="button" 
                            th:onclick="'toggleEdit(' + ${comment.id} + ')'">ì·¨ì†Œ</button>
                </form>
            </div>
            
            <!-- ëŒ“ê¸€ ì•¡ì…˜ -->
            <div class="comment-actions">
                <!-- ì¢‹ì•„ìš” -->
                <form th:action="@{/post/comment/like}" method="post" style="display:inline;">
                    <input type="hidden" name="commentId" th:value="${comment.id}">
                    <button type="submit" style="background:none; border:none; cursor:pointer;">
                        <span th:text="${comment.likedByMe ? 'â¤ï¸' : 'ğŸ¤'}">ğŸ¤</span>
                        <span th:text="${comment.likeCount}">0</span>
                    </button>
                </form>
                
                <span th:onclick="'toggleReply(' + ${comment.id} + ')'">ğŸ’¬ 0</span>
                <span th:onclick="'toggleEdit(' + ${comment.id} + ')'">âœ”ï¸ ìˆ˜ì •</span>
                
                <!-- ì‚­ì œ -->
                <form th:action="@{/post/comment/delete}" method="post" 
                      style="display:inline;"
                      onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                    <input type="hidden" name="commentId" th:value="${comment.id}">
                    <button type="submit" 
                            style="background:none; border:none; cursor:pointer; color:#666;">
                        âœ–ï¸ ì‚­ì œ
                    </button>
                </form>
            </div>
            
            <!-- ëŒ€ëŒ“ê¸€ ì…ë ¥ í¼ (ìˆ¨ê¹€) -->
            <div class="reply-form" th:id="'reply-form-' + ${comment.id}">
                <form th:action="@{/post/comment/reply}" method="post">
                    <input type="hidden" name="parentId" th:value="${comment.id}">
                    <textarea name="content" placeholder="ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                    <button type="submit">ë“±ë¡</button>
                    <button type="button" 
                            th:onclick="'toggleReply(' + ${comment.id} + ')'">ì·¨ì†Œ</button>
                </form>
            </div>
            
			<!-- ëŒ€ëŒ“ê¸€ ëª©ë¡ -->
			<div class="reply" th:each="reply : ${comment.replies}">
			    <div class="comment-header">
			        <div class="profile tiny"></div>
			        <span class="author" th:text="${reply.author}">ìœ ì €</span>
			        <span class="time">ë°©ê¸ˆ</span>
			    </div>
			    <div class="comment-content" th:text="${reply.content}">
			        ëŒ€ëŒ“ê¸€ ë‚´ìš©
			    </div>
			    <div class="comment-actions">
			        <!-- âœ… ëŒ€ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ -->
			        <form th:action="@{/post/comment/reply/like}" method="post" style="display:inline;">
			            <input type="hidden" name="parentId" th:value="${comment.id}">
			            <input type="hidden" name="replyId" th:value="${reply.id}">
			            <button type="submit" style="background:none; border:none; cursor:pointer;">
			                <span th:text="${reply.likedByMe ? 'â¤ï¸' : 'ğŸ¤'}">ğŸ¤</span>
			                <span th:text="${reply.likeCount}">0</span>
			            </button>
			        </form>
			    </div>
			</div>
        </div>
    </div>
</div>

<script>
    // ëŒ“ê¸€ ì„¹ì…˜ í† ê¸€
    function toggleCommentSection() {
        const commentSection = document.getElementById('comment-section');
        if (commentSection.style.display === 'none') {
            commentSection.style.display = 'block';
        } else {
            commentSection.style.display = 'none';
        }
    }
    
    // ìˆ˜ì • í¼ í† ê¸€
    function toggleEdit(commentId) {
        const content = document.getElementById('comment-content-' + commentId);
        const editForm = document.getElementById('edit-form-' + commentId);
        
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
        editForm.classList.toggle('active');
    }
    
    // ëŒ€ëŒ“ê¸€ í¼ í† ê¸€
    function toggleReply(commentId) {
        const replyForm = document.getElementById('reply-form-' + commentId);
        replyForm.classList.toggle('active');
    }
</script>
</body>
</html>